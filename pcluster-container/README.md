# AWS ParallelCluster ì»¨í…Œì´ë„ˆ ê¸°ë°˜ ë¶„ì‚° í•™ìŠµ ê°€ì´ë“œ

## ğŸ“‹ ê°œìš”

### ê°€ì´ë“œ ëª©ì 

ì´ ê°€ì´ë“œëŠ” AWS ParallelClusterì™€ Slurmì„ í™œìš©í•˜ì—¬ **ì»¨í…Œì´ë„ˆ ê¸°ë°˜ ë¶„ì‚° í•™ìŠµ í™˜ê²½**ì„ êµ¬ì¶•í•˜ëŠ” ë°©ë²•ì„ ë‹¨ê³„ë³„ë¡œ ì„¤ëª…í•©ë‹ˆë‹¤.
GPU í´ëŸ¬ìŠ¤í„° í™˜ê²½ì—ì„œ ì»¤ìŠ¤í…€ ì»¨í…Œì´ë„ˆ ì´ë¯¸ì§€ë¥¼ ì‚¬ìš©í•˜ì—¬ í™•ì¥ ê°€ëŠ¥í•œ ë¶„ì‚° í•™ìŠµì„ ìˆ˜í–‰í•˜ê³ ì í•˜ëŠ” ML ì¸í”„ë¼ ì—”ì§€ë‹ˆì–´ì™€ ëª¨ë¸ëŸ¬ë¥¼ ìœ„í•œ ì‹¤ì „ ê°€ì´ë“œì…ë‹ˆë‹¤.

### ì£¼ìš” ëª©í‘œ

- AWS ParallelClusterë¥¼ í†µí•œ HPC í´ëŸ¬ìŠ¤í„° êµ¬ì¶•
- Slurm ê¸°ë°˜ ì‘ì—… ìŠ¤ì¼€ì¤„ë§ ë° ë¦¬ì†ŒìŠ¤ ê´€ë¦¬
- Pyxis/Enrootë¥¼ í™œìš©í•œ ì»¨í…Œì´ë„ˆ ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´ì…˜
- ë©€í‹° ë…¸ë“œ ë¶„ì‚° í•™ìŠµ í™˜ê²½ êµ¬ì„±


---

## ğŸ“ ê° ë¬¸ì„œ ë²”ìœ„

### [README.md](./README.md)
- ê°€ì´ë“œ ëª©ì  / ëª©í‘œ / ê° ë¬¸ì„œ ë²”ìœ„ / ì•„í‚¤í…ì²˜ / ì£¼ìš” êµ¬ì„± ìš”ì†Œ ì†Œê°œ

### [01-prerequisites.md](./docs/01-prerequisites.md)
- í•„ìš” ë„êµ¬ (AWS CLI, ParallelCluster CLI) ì„¤ì¹˜
- ì½”ì–´ ì¸í”„ë¼ ì„¤ì¹˜ - VPC ë° ë„¤íŠ¸ì›Œí¬ / ê³µìœ  ìŠ¤í† ë¦¬ì§€
- ECR ë° ì˜ˆì œ custom DLC(Deep Learning Container) ì¤€ë¹„
- S3 - ì˜ˆì œ í•™ìŠµ ë°ì´í„°ì…‹, í´ëŸ¬ìŠ¤í„° ìƒì„±ì„ ìœ„í•œ ìŠ¤í¬ë¦½íŠ¸ ìš©ë„ ë²„í‚· ì¤€ë¹„

### [02-pcluster-deployment.md](./docs/02-pcluster-deployment.md)
- í´ëŸ¬ìŠ¤í„° ìƒì„± ë° ê²€ì¦
- Slurm ê¸°ë³¸ ì‚¬ìš© - nvidia-smi ì‹¬í”Œ í…ŒìŠ¤íŠ¸

### [03-distributed-training.md](./docs/03-distributed-training.md)
- ì»¨í…Œì´ë„ˆ ì´ë¯¸ì§€ sqsh ë³€í™˜
- Slurm ì‘ì—… ì œì¶œ

---

## ğŸ—ï¸ ì•„í‚¤í…ì²˜

### ì „ì²´ êµ¬ì„±ë„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         AWS Cloud                           â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                    VPC                               â”‚   â”‚
â”‚  â”‚                                                      â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚   â”‚
â”‚  â”‚  â”‚  Head Node   â”‚         â”‚   Compute Fleet     â”‚    â”‚   â”‚
â”‚  â”‚  â”‚  (Slurm      â”‚â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚    (GPU Nodes)      â”‚    â”‚   â”‚
â”‚  â”‚  â”‚   Controller)â”‚         â”‚                     â”‚    â”‚   â”‚
â”‚  â”‚  â”‚              â”‚         â”‚  â”Œâ”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”     â”‚    â”‚   â”‚
â”‚  â”‚  â”‚  - Slurm     â”‚         â”‚  â”‚GPU â”‚  â”‚GPU â”‚     â”‚    â”‚   â”‚
â”‚  â”‚  â”‚    Master    â”‚         â”‚  â”‚Nodeâ”‚  â”‚Nodeâ”‚ ... â”‚    â”‚   â”‚
â”‚  â”‚  â”‚  - Job Queue â”‚         â”‚  â””â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”˜     â”‚    â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚   â”‚
â”‚  â”‚         â”‚                           â”‚                â”‚   â”‚
â”‚  â”‚         â”‚                           â”‚                â”‚   â”‚
â”‚  â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚   â”‚
â”‚  â”‚                     â”‚                                â”‚   â”‚
â”‚  â”‚              â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”                         â”‚   â”‚
â”‚  â”‚              â”‚   Shared    â”‚                         â”‚   â”‚
â”‚  â”‚              â”‚   Storage   â”‚                         â”‚   â”‚
â”‚  â”‚              â”‚  (FSx/ZFS)  â”‚                         â”‚   â”‚
â”‚  â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                         â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚     S3      â”‚      â”‚     ECR     â”‚    â”‚   IAM    â”‚       â”‚
â”‚  â”‚  (Dataset)  â”‚      â”‚ (Container) â”‚    â”‚  (Roles) â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ì›Œí¬í”Œë¡œìš°

```
1. ì‚¬ìš©ì â†’ Head Node: ì‘ì—… ì œì¶œ (sbatch)
2. Slurm Controller: ë¦¬ì†ŒìŠ¤ í• ë‹¹ ë° ìŠ¤ì¼€ì¤„ë§
3. Compute Node: Auto Scalingìœ¼ë¡œ ìë™ í”„ë¡œë¹„ì €ë‹
4. Enroot: ECRì—ì„œ ì»¨í…Œì´ë„ˆ ì´ë¯¸ì§€ pull
5. Pyxis: Slurmê³¼ í†µí•©í•˜ì—¬ ì»¨í…Œì´ë„ˆ ì‹¤í–‰
6. NCCL: GPU ê°„ ê³ ì† í†µì‹  (All-Reduce, All-Gather ë“±)
7. í•™ìŠµ ì™„ë£Œ: ê²°ê³¼ë¥¼ S3 ë˜ëŠ” ê³µìœ  ìŠ¤í† ë¦¬ì§€ì— ì €ì¥
```


---

## ğŸ”§ ì£¼ìš” êµ¬ì„± ìš”ì†Œ

### 1. AWS ParallelCluster

> **AWS ParallelCluster**ëŠ” AWSì—ì„œ HPC í´ëŸ¬ìŠ¤í„°ë¥¼ ì‰½ê²Œ ë°°í¬í•˜ê³  ê´€ë¦¬í•  ìˆ˜ ìˆëŠ” ì˜¤í”ˆì†ŒìŠ¤ í´ëŸ¬ìŠ¤í„° ê´€ë¦¬ ë„êµ¬ì…ë‹ˆë‹¤.

**ì£¼ìš” ê¸°ëŠ¥:**
- ğŸš€ ê°„ë‹¨í•œ YAML ì„¤ì •ìœ¼ë¡œ í´ëŸ¬ìŠ¤í„° ìƒì„±
- ğŸ“ˆ Auto Scaling ê¸°ë°˜ ë™ì  ë¦¬ì†ŒìŠ¤ ê´€ë¦¬
- ğŸ’¾ ë‹¤ì–‘í•œ ìŠ¤í† ë¦¬ì§€ ì˜µì…˜ ì§€ì› (EBS, FSx for Lustre, EFS)
- ğŸ” IAM ê¸°ë°˜ ë³´ì•ˆ ë° ê¶Œí•œ ê´€ë¦¬
- ğŸŒ ë‹¤ì¤‘ AZ ë° Placement Group ì§€ì›

**ì§€ì› ìŠ¤ì¼€ì¤„ëŸ¬:**
- Slurm (ê¶Œì¥)
- AWS Batch
- Torque

**ê³µì‹ ë¬¸ì„œ:** [AWS ParallelCluster Documentation](https://docs.aws.amazon.com/parallelcluster/)

---

### 2. Slurm Workload Manager

> **Slurm**ì€ ëŒ€ê·œëª¨ í´ëŸ¬ìŠ¤í„° í™˜ê²½ì—ì„œ ì‘ì—… ìŠ¤ì¼€ì¤„ë§ ë° ë¦¬ì†ŒìŠ¤ ê´€ë¦¬ë¥¼ ë‹´ë‹¹í•˜ëŠ” ì˜¤í”ˆì†ŒìŠ¤ ì›Œí¬ë¡œë“œ ë§¤ë‹ˆì €ì…ë‹ˆë‹¤.

**ì£¼ìš” íŠ¹ì§•:**
- ğŸ“Š íš¨ìœ¨ì ì¸ ì‘ì—… í ê´€ë¦¬
- ğŸ¯ ë¦¬ì†ŒìŠ¤ ê¸°ë°˜ ìŠ¤ì¼€ì¤„ë§ (CPU, GPU, ë©”ëª¨ë¦¬)
- ğŸ‘¥ ë‹¤ì¤‘ ì‚¬ìš©ì ë° ê·¸ë£¹ ê´€ë¦¬
- ğŸ”„ ìš°ì„ ìˆœìœ„ ë° QoS (Quality of Service) ì„¤ì •
- ğŸ“ ìƒì„¸í•œ ì‘ì—… ë¡œê·¸ ë° í†µê³„

**í•µì‹¬ ëª…ë ¹ì–´:**
```bash
sbatch    # ë°°ì¹˜ ì‘ì—… ì œì¶œ
squeue    # ì‘ì—… í í™•ì¸
sinfo     # ë…¸ë“œ ìƒíƒœ í™•ì¸
scancel   # ì‘ì—… ì·¨ì†Œ
scontrol  # í´ëŸ¬ìŠ¤í„° ì œì–´
sacct     # ì‘ì—… ê³„ì • ì •ë³´
```

**ê³µì‹ ë¬¸ì„œ:** [Slurm Documentation](https://slurm.schedmd.com/documentation.html)

---

### 3. Pyxis / Enroot

> **Enroot**ëŠ” ê²½ëŸ‰ ì»¨í…Œì´ë„ˆ ëŸ°íƒ€ì„ì´ë©°, **Pyxis**ëŠ” Slurmê³¼ Enrootë¥¼ í†µí•©í•˜ëŠ” í”ŒëŸ¬ê·¸ì¸ì…ë‹ˆë‹¤.

#### Enroot
- ğŸ³ Docker ë° OCI í˜¸í™˜ ì»¨í…Œì´ë„ˆ ì´ë¯¸ì§€ ì§€ì›
- âš¡ ë¹ ë¥¸ ì‹œì‘ ì‹œê°„ ë° ë‚®ì€ ì˜¤ë²„í—¤ë“œ
- ğŸ”’ Rootless ì‹¤í–‰ ê°€ëŠ¥
- ğŸ’½ ë ˆì´ì–´ ê¸°ë°˜ ì´ë¯¸ì§€ ê´€ë¦¬

#### Pyxis
- ğŸ”— Slurmê³¼ Enrootì˜  í†µí•©
- ğŸ¯ `srun --container-image` ëª…ë ¹ìœ¼ë¡œ ê°„í¸í•œ ì‹¤í–‰
- ğŸŒ í™˜ê²½ ë³€ìˆ˜ ë° ë³¼ë¥¨ ë§ˆìš´íŠ¸ ìë™ ì²˜ë¦¬
- ğŸ“¦ ECR, Docker Hub ë“± ë‹¤ì–‘í•œ ë ˆì§€ìŠ¤íŠ¸ë¦¬ ì§€ì›

**ì‚¬ìš© ì˜ˆì‹œ:**
```bash
# ECR ì´ë¯¸ì§€ë¡œ ë¶„ì‚° í•™ìŠµ ì‹¤í–‰
srun --container-image=<account>.dkr.ecr.us-east-1.amazonaws.com/training:latest \
     --gpus-per-node=8 \
     --nodes=4 \
     python train.py
```

**ê³µì‹ ì €ì¥ì†Œ:**
- [Enroot GitHub](https://github.com/NVIDIA/enroot)
- [Pyxis GitHub](https://github.com/NVIDIA/pyxis)

---